@page
@model WebApplication2.Pages.ChooseStrategiesModel
@{
    ViewData["Title"] = "Step 2";
}

<h1>Step 2</h1>

<p>Chọn chiến lược bao phủ phù hợp</p>

<div>
    <div>UAV data: @Model.UAVs.Count</div>
    <div>Area: @Model.GeoJsonData.Length km²</div> <!-- Display length of GeoJSON for reference -->
</div>

<p>Sau đây là một vài gợi ý các kịch bản:</p>
<p>Kịch bản cứu hộ: sử dụng Option 1</p>

@foreach (var strategy in Model.Strategies)
{
    <div>
        <h3>Option @(strategy.Id): @(strategy.Name)</h3>
        <p><strong>Công nghệ:</strong> @(strategy.Description)</p>
        <div>
            <div>UAVs: @(strategy.UAVCount)</div>
            <div>Thời gian duy trì tối đa: @(strategy.MaxDuration)</div>
            <div>Phạm vi tối đa: @(strategy.MaxRange)</div>
            <div>Tốc độ truyền: @(strategy.TransmissionSpeed)</div>
        </div>
        <button onclick="chooseOption(@(strategy.Id))" class="btn btn-primary">Choose</button>
    </div>
}

<!-- Display the map -->
<div id="map" style="height: 500px; width: 100%;"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/osmtogeojson/osmtogeojson.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script>

<script>
    // Initialize the map
    const map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    // Load OSM data from session
    var osmData = '@Model.OsmData';

    if (osmData) {
        const geoJsonData = osmtogeojson(new DOMParser().parseFromString(osmData, 'text/xml'));

        if (geoJsonData && geoJsonData.features) {
            L.geoJSON(geoJsonData).addTo(map);
            map.fitBounds(L.geoJSON(geoJsonData).getBounds());  // Adjust the map view to fit the OSM data
        }
    }

    // Optional: Add any additional features such as markers, radius, etc.
</script>

<script>
    function chooseOption(option) {
        window.location.href = '/StrategyDetails/' + option;
    }
</script>
